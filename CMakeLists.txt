CMAKE_MINIMUM_REQUIRED(VERSION 3.0)
PROJECT(rnn2d)

ENABLE_TESTING()

LIST(APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x -Wall -pedantic")

FIND_PACKAGE(BLAS REQUIRED)
FIND_PACKAGE(Glog REQUIRED)
FIND_PACKAGE(GTest)
FIND_PACKAGE(GMock)
FIND_PACKAGE(OpenMP)
IF(OPENMP_FOUND)
  SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
ENDIF()

ADD_LIBRARY(math_cpu math_cpu.cc math_cpu.h)
TARGET_LINK_LIBRARIES(math_cpu ${BLAS_LIBRARIES})

IF(GTEST_FOUND AND GMOCK_FOUND)
  INCLUDE_DIRECTORIES(${GTEST_INCLUDE_DIRS})
  INCLUDE_DIRECTORIES(${GMOCK_INCLUDE_DIRS})

  ADD_EXECUTABLE(lstm_cpu_test lstm_cpu_test.cc)
  TARGET_LINK_LIBRARIES(lstm_cpu_test
    math_cpu ${GMOCK_MAIN_LIBRARIES})
  GTEST_ADD_TESTS(lstm_cpu_test "" lstm_cpu_test.cc)
ENDIF()
